{% extends 'base.html' %}
{% load l10n %}

{% block title %}Мой график{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3 mb-md-4">
    <h1 class="h3"><i class="bi bi-clock-history"></i> Мой график на неделю</h1>
</div>

<!-- Секция с услугами специалиста -->
{% if services %}
<div class="card mb-4">
    <div class="card-header bg-light">
        <h5 class="mb-0"><i class="bi bi-heart-pulse"></i> Мои услуги</h5>
    </div>
    <div class="card-body">
        <div class="d-flex flex-wrap gap-2" id="services-list">
            {% for service in services %}
            <span class="badge bg-primary {% if forloop.counter > 5 %}service-hidden d-none{% endif %}" style="font-size: 0.9rem; padding: 0.5rem 0.75rem;">
                <i class="bi bi-check-circle"></i> {{ service.name }}
            </span>
            {% endfor %}
        </div>
        {% if services|length > 5 %}
        <div class="mt-3">
            <button type="button" class="btn btn-sm btn-outline-primary" id="toggle-services-btn" onclick="toggleServices()">
                <i class="bi bi-chevron-down"></i> Показать еще ({{ services|length|add:"-5" }})
            </button>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

<div class="alert alert-info">
    <i class="bi bi-calendar"></i>
    <strong>{{ total_bookings }}</strong> бронирований с {{ today|date:"d.m.Y" }} по {{ week_end|date:"d.m.Y" }}
</div>

{% if total_bookings > 0 %}
<div class="row g-3">
    {% for day_info in week_days %}
    <div class="col-12 col-md-6 col-lg-4">
        <div class="card h-100 {% if day_info.is_today %}border-primary{% endif %}">
            <div class="card-header {% if day_info.is_today %}bg-primary text-white{% else %}bg-light{% endif %}">
                <h5 class="mb-0">
                    {% if day_info.is_today %}
                        <i class="bi bi-calendar-check"></i> Сегодня
                    {% else %}
                        <i class="bi bi-calendar"></i> 
                        {% if day_info.date.weekday == 0 %}Понедельник
                        {% elif day_info.date.weekday == 1 %}Вторник
                        {% elif day_info.date.weekday == 2 %}Среда
                        {% elif day_info.date.weekday == 3 %}Четверг
                        {% elif day_info.date.weekday == 4 %}Пятница
                        {% elif day_info.date.weekday == 5 %}Суббота
                        {% elif day_info.date.weekday == 6 %}Воскресенье
                        {% endif %}
                    {% endif %}
                    <small class="ms-2">{{ day_info.date|date:"d.m.Y" }}</small>
                    <span class="badge {% if day_info.is_today %}bg-light text-primary{% else %}bg-secondary{% endif %} ms-2">
                        {{ day_info.bookings|length }}
                    </span>
                </h5>
            </div>
            <div class="card-body">
                {% if day_info.bookings %}
                <div class="list-group list-group-flush">
                    {% for booking in day_info.bookings %}
                    <div class="list-group-item px-0 py-2">
                        <div class="d-flex w-100 justify-content-between align-items-start mb-1">
                            <h6 class="mb-0">
                                <i class="bi bi-person"></i> {{ booking.guest_name }}
                                {% if booking.guest_room_number %}
                                    <span class="badge bg-secondary ms-1">{{ booking.guest_room_number }}</span>
                                {% endif %}
                            </h6>
                            <small class="text-muted">
                                <strong>{{ booking.start_time|time:"H:i" }}</strong> - {{ booking.end_time|time:"H:i" }}
                            </small>
                        </div>
                        <p class="mb-1 small">
                            <i class="bi bi-heart-pulse"></i> {{ booking.service_variant.service.name }} - {{ booking.service_variant.name_suffix }}
                        </p>
                        <p class="mb-0 small text-muted">
                            <i class="bi bi-building"></i> {{ booking.cabinet.name }}
                        </p>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted text-center mb-0">
                    <i class="bi bi-calendar-x"></i> Нет бронирований
                </p>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card">
    <div class="card-body text-center">
        <i class="bi bi-calendar-x" style="font-size: 4rem; color: #6c757d;"></i>
        <p class="mt-3 mb-0">На эту неделю нет запланированных бронирований</p>
    </div>
</div>
{% endif %}

{% load static %}
<script src="{% static 'js/specialist_schedule.js' %}"></script>
{% endblock %}

