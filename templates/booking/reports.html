{% extends 'base.html' %}

{% block title %}Отчеты{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3 mb-md-4">
    <h1 class="h3"><i class="bi bi-graph-up"></i> Отчеты</h1>
</div>

<div class="card mb-3 mb-md-4">
    <div class="card-header bg-info text-white">
        <h4 class="mb-0 h5"><i class="bi bi-filter"></i> Фильтр отчетов</h4>
    </div>
    <div class="card-body">
        <form method="GET" action="{% url 'reports' %}" class="row g-3">
            <div class="col-12 col-md-5">
                {{ form.start_date.label_tag }}
                {{ form.start_date }}
            </div>
            <div class="col-12 col-md-5">
                {{ form.end_date.label_tag }}
                {{ form.end_date }}
            </div>
            <div class="col-12 col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="bi bi-search"></i> <span class="d-none d-sm-inline">Показать</span><span class="d-sm-none">OK</span>
                </button>
            </div>
        </form>
    </div>
</div>

{% if service_popularity or specialist_load %}
<div class="row g-3">
    <div class="col-12 col-md-6">
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0"><i class="bi bi-trophy"></i> Популярность услуг</h4>
            </div>
            <div class="card-body">
                {% if service_popularity %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Услуга</th>
                                <th class="text-end">Количество</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in service_popularity %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>{{ item.service_variant__service__name }}</td>
                                <td class="text-end">
                                    <span class="badge bg-success">{{ item.count }}</span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted">Нет данных за выбранный период</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-12 col-md-6">
        <div class="card mb-3 mb-md-4">
            <div class="card-header bg-warning text-dark">
                <h4 class="mb-0 h5"><i class="bi bi-clock-history"></i> Нагрузка на специалистов</h4>
            </div>
            <div class="card-body">
                {% if specialist_load %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Специалист</th>
                                <th class="text-end">Нагрузка</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in specialist_load %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>{{ item.specialist__full_name }}</td>
                                <td class="text-end">
                                    <span class="badge bg-warning text-dark">{{ item.total_duration_display }}</span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted">Нет данных за выбранный период</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="card">
    <div class="card-body text-center">
        <i class="bi bi-graph-up-arrow" style="font-size: 4rem; color: #6c757d;"></i>
        <p class="mt-3 mb-0">Выберите период для просмотра отчетов</p>
    </div>
</div>
{% endif %}
{% endblock %}


