# Satva Wellness Booking System

[![Python](https://img.shields.io/badge/Python-3.12+-blue.svg)](https://www.python.org/)
[![Django](https://img.shields.io/badge/Django-5.2.7-green.svg)](https://www.djangoproject.com/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

Система управления бронированиями для спа-салона отеля Satva Wellness. Веб-приложение на Django для администрирования расписаний, бронирований и управления ресурсами.

## Описание

Satva Wellness Booking System - это комплексная система управления бронированиями, разработанная для автоматизации процессов записи клиентов на услуги спа-салона. Система обеспечивает эффективное управление расписаниями специалистов, кабинетами и услугами, предоставляя удобный интерфейс для администраторов и специалистов.

## Основные возможности

### Для администраторов
- **Календарь бронирований** - визуализация всех бронирований с возможностью переключения между видами (месяц, неделя, день)
- **Быстрое создание бронирований** - создание записей одним кликом на свободный слот в календаре
- **Drag & Drop** - перемещение бронирований для изменения времени простым перетаскиванием
- **Управление услугами** - создание и редактирование услуг с различными вариантами (длительность, цена)
- **Управление специалистами** - профили специалистов с назначением услуг
- **Управление кабинетами** - типизация кабинетов и управление их доступностью
- **Графики работы** - настройка расписания работы специалистов
- **Отчеты** - аналитика по популярности услуг и нагрузке на специалистов
- **Редактирование бронирований** - изменение деталей записей, статусов и времени

### Для специалистов
- **Личный график** - просмотр своих бронирований на текущий день
- **Информация о клиентах** - данные о гостях, времени и кабинетах
- **Email уведомления** - автоматические уведомления о новых бронированиях
- **API доступ** - REST API для интеграции с мобильными приложениями
- **Регистрация** - самостоятельная регистрация в системе

### Общие возможности
- **Регистрация специалистов** - самостоятельная регистрация новых специалистов
- **Email уведомления** - автоматическая отправка уведомлений специалистам о новых бронированиях
- **Цветовая индикация** - визуальное различие кабинетов и статусов бронирований
- **Адаптивный дизайн** - оптимизация для мобильных устройств и планшетов
- **Автоматические расчеты** - расчет времени окончания с учетом буферного времени
- **Проверка конфликтов** - автоматическая валидация доступности слотов

## Технологический стек

- **Backend**: Django 5.2.7
- **Frontend**: Bootstrap 5.3, FullCalendar 5.11.0
- **База данных**: PostgreSQL
- **API**: Django REST Framework с JWT аутентификацией
- **Деплой**: Docker (рекомендуется), Gunicorn + Nginx

## Установка и настройка

### Требования
- Python 3.12+
- PostgreSQL 12+
- pip

### Установка

1. **Клонируйте репозиторий и перейдите в директорию проекта**
   ```bash
   cd "Satva willnes booking"
   ```

2. **Создайте виртуальное окружение**
   ```bash
   python3 -m venv venv
   source venv/bin/activate  # На Windows: venv\Scripts\activate
   ```

3. **Установите зависимости**
   ```bash
   pip install -r requirements.txt
   ```

4. **Настройте базу данных PostgreSQL**
   ```bash
   createdb satva_wellness_booking
   ```

5. **Настройте переменные окружения**
   Создайте файл `.env` в корне проекта:
   ```env
   DJANGO_SECRET_KEY=your-secret-key-here
   DATABASE_NAME=satva_wellness_booking
   DATABASE_USER=postgres
   DATABASE_PASSWORD=your-password
   DATABASE_HOST=localhost
   DATABASE_PORT=5432
   
   # Email настройки (для отправки уведомлений специалистам)
   EMAIL_HOST=smtp.gmail.com
   EMAIL_PORT=587
   EMAIL_USE_TLS=True
   EMAIL_HOST_USER=your-email@gmail.com
   EMAIL_HOST_PASSWORD=your-app-password
   DEFAULT_FROM_EMAIL=your-email@gmail.com
   ```
   
   **Примечание:** Для Gmail необходимо использовать "Пароль приложения" вместо обычного пароля. Для тестирования можно использовать консольный backend (см. `settings.py`).

6. **Выполните миграции**

   **Важно:** При первом применении миграций будет выполнена миграция `0011_add_guest_model.py`, которая создает модель Guest и мигрирует данные. Подробнее см. [MIGRATION_RISK_ANALYSIS.md](MIGRATION_RISK_ANALYSIS.md) и [DEPLOYMENT.md](DEPLOYMENT.md).
   ```bash
   python manage.py migrate
   ```

7. **Создайте суперпользователя**
   ```bash
   python manage.py createsuperuser
   ```

8. **Запустите сервер разработки**
   ```bash
   python manage.py runserver
   ```

Откройте браузер и перейдите по адресу: http://localhost:8000/

## Первичная настройка

### 1. Создание групп пользователей
Войдите в админ-панель (`/admin/`) и создайте группы:
- **SuperAdmin** - Супер-администратор (полный доступ)
- **Admin** - Администратор
- **Specialist** - Специалист

### 2. Настройка системы
- Перейдите в "Настройки системы" в админ-панели
- Настройте время работы и буферное время между бронированиями

### 3. Создание типов кабинетов
Примеры: Массажный, Косметологический, VIP

### 4. Создание кабинетов
Создайте кабинеты и назначьте им типы

### 5. Создание услуг
- Создайте услуги (например, "Тайский массаж", "Уход за лицом")
- Для каждой услуги укажите требуемые типы кабинетов
- Создайте варианты услуг с указанием длительности и цены

### 6. Создание специалистов
- Специалисты могут регистрироваться самостоятельно через `/register/specialist/`
- Или администратор может создать их в админ-панели
- Назначьте специалистам услуги, которые они могут выполнять

### 7. Настройка графиков работы
- Перейдите в "Управление графиками" (`/manage-schedules/`)
- Выберите специалиста и настройте его расписание работы

## Структура проекта

```
satva-wellness-booking/
├── booking/              # Основное приложение
│   ├── models.py        # Модели данных
│   ├── views.py         # Представления
│   ├── forms.py         # Формы
│   ├── urls.py          # URL маршрутизация
│   ├── utils.py         # Утилиты (поиск слотов)
│   ├── decorators.py    # Декораторы доступа
│   ├── api_views.py     # REST API views
│   ├── serializers.py   # API сериализаторы
│   └── middleware.py    # Middleware для логирования
├── config/              # Настройки проекта
│   ├── settings.py      # Настройки разработки
│   ├── settings_production.py  # Настройки production
│   └── urls.py          # Главный URLconf
├── templates/           # HTML шаблоны
│   ├── base.html        # Базовый шаблон
│   ├── calendar.html    # Календарь бронирований
│   └── booking/         # Шаблоны бронирований
├── staticfiles/         # Статические файлы
└── requirements.txt     # Зависимости Python
```

## Модели данных

- **SystemSettings** - Глобальные настройки системы (Singleton)
- **CabinetType** - Типы кабинетов
- **Cabinet** - Кабинеты
- **Service** - Услуги
- **ServiceVariant** - Варианты услуг (длительность, цена)
- **SpecialistProfile** - Профили специалистов
- **SpecialistSchedule** - Графики работы специалистов
- **Booking** - Бронирования

## API Endpoints

### Аутентификация
- `POST /api/v1/token/` - Получение JWT токена
- `POST /api/v1/token/refresh/` - Обновление JWT токена

### Бронирования
- `GET /api/v1/my-schedule/` - Список бронирований специалиста (требует аутентификацию)

Подробнее: [DEPLOYMENT.md](DEPLOYMENT.md#api).

## Развертывание

### Docker (рекомендуется)

Проект готов к развертыванию с помощью Docker и Docker Compose. Подробные инструкции смотрите в [DEPLOYMENT.md](DEPLOYMENT.md).

**Быстрый старт:**
```bash
# Клонировать репозиторий
git clone https://github.com/santex85/satva_willnes_booking.git
cd satva_willnes_booking

# Создать .env файл из примера
cp .env.example .env
# Отредактировать .env файл с вашими настройками

# Запустить контейнеры
docker compose up -d

# Создать суперпользователя
docker compose exec web python manage.py createsuperuser
```

Или используйте Makefile:
```bash
make build
make up
make createsuperuser
```

### Традиционный деплой (без Docker)

Краткое описание и ссылка на альтернативный способ развертывания — в [DEPLOYMENT.md](DEPLOYMENT.md#развертывание-без-docker-альтернатива).

## Группы пользователей

- **SuperAdmin** - Супер-администратор с полным доступом ко всем функциям
- **Admin** - Администратор с доступом к календарю, отчетам и управлению
- **Specialist** - Специалист с доступом к личному графику и API

## Безопасность

- Аутентификация через Django Session и JWT
- Авторизация на основе групп пользователей
- Валидация всех входных данных
- Защита от CSRF атак
- Централизованное логирование ошибок

## Документация

| Файл | Описание |
|------|----------|
| [DEPLOYMENT.md](DEPLOYMENT.md) | Развертывание: Docker, безопасный деплой, откат, SSL, бэкапы |
| [CONTRIBUTING.md](CONTRIBUTING.md) | Участие в проекте, стиль кода, коммиты |
| [TESTING.md](TESTING.md) | Тестирование скриптов деплоя |
| [MIGRATION_RISK_ANALYSIS.md](MIGRATION_RISK_ANALYSIS.md) | Риски миграции Guest Model |
| [docs/INDEX.md](docs/INDEX.md) | Индекс всей документации |

## Лицензия

Проект разработан для внутреннего использования в Satva Wellness.

## Контакты

Для вопросов и поддержки обращайтесь к администратору системы.
